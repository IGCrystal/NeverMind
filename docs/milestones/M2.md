# M2 交付说明（mm）

## 范围

- 物理内存管理：frame bitmap + multiboot2 memory map 初始化
- 虚拟内存管理：4KB / 2MB 映射接口
- 内核堆：`kmalloc/kfree` 初版
- 测试：用户态模拟单元测试 + QEMU 启动烟测

## 代码文件

- `include/nm/mm.h`
- `include/nm/multiboot2.h`
- `kernel/mm/pmm.c`
- `kernel/mm/vmm.c`
- `kernel/mm/kheap.c`
- `tests/unit/test_pmm_kheap.c`

## 关键函数签名

- `void mm_init(uint64_t mb2_info_ptr);`
- `void pmm_init_from_multiboot2(uint64_t mb2_info_ptr);`
- `uint64_t pmm_alloc_page(void);`
- `void pmm_free_page(uint64_t phys_addr);`
- `bool vmm_map_page(uint64_t virt_addr, uint64_t phys_addr, uint64_t flags);`
- `bool vmm_map_2m(uint64_t virt_addr, uint64_t phys_addr, uint64_t flags);`
- `void *kmalloc(size_t size);`
- `void kfree(void *ptr);`

## 验证命令

```bash
make clean all
make test
make smoke
```
