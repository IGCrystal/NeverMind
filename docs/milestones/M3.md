# M3 交付说明（proc）

## 范围

- `task_struct` 与 kernel thread 创建
- 可抢占调度框架（RR + 近似 CFS）
- x86_64 上下文切换汇编入口
- syscall 分发层与示例 syscall

## 代码文件

- `include/nm/proc.h`
- `include/nm/syscall.h`
- `kernel/proc/task.c`
- `kernel/proc/sched.c`
- `kernel/proc/switch.S`
- `kernel/syscall/syscall.c`
- `tests/unit/test_sched.c`

## 关键函数签名

- `void proc_init(void);`
- `struct nm_task *task_create_kernel_thread(const char *name, void (*entry)(void *), void *arg);`
- `void sched_init(enum nm_sched_policy policy);`
- `struct nm_task *sched_pick_next(void);`
- `void sched_on_run(struct nm_task *task, uint64_t ticks);`
- `void nm_context_switch(uint64_t **old_rsp, uint64_t *new_rsp);`
- `int64_t syscall_dispatch(uint64_t nr, uint64_t arg1, uint64_t arg2, uint64_t arg3, uint64_t arg4,`
  `uint64_t arg5, uint64_t arg6);`

## 验证命令

```bash
make clean all
make test
make smoke
```
