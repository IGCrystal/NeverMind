# M4 交付说明（fs）

## 范围

- VFS 抽象层（vnode/file_ops）
- tmpfs（内存目录树与文件读写）
- ext2 最小实现（inode 元数据、目录项、读写骨架）
- 文件 API：open/read/write/lseek/close/stat

## 代码文件

- `include/nm/fs.h`
- `kernel/fs/vfs.c`
- `kernel/fs/tmpfs.c`
- `kernel/fs/ext2.c`
- `tests/unit/test_vfs.c`

## 关键函数签名

- `void fs_init(void);`
- `int fs_mount_root(const struct nm_filesystem *fs);`
- `int fs_open(const char *path, uint32_t flags, uint32_t mode);`
- `int64_t fs_read(int fd, void *buf, uint64_t len);`
- `int64_t fs_write(int fd, const void *buf, uint64_t len);`
- `int64_t fs_lseek(int fd, int64_t offset, int whence);`
- `int fs_stat(const char *path, struct nm_stat *st);`

## 验证命令

```bash
make clean all
make test
make smoke
```
