# M5 交付说明（drivers）

## 范围

- 中断驱动框架（IRQ 注册 + top-half/bottom-half）
- PIT timer 驱动
- 键盘中断驱动
- PCI 枚举与设备查询
- RTL8139 驱动骨架

## 代码文件

- `include/nm/irq.h`
- `include/nm/driver.h`
- `include/nm/pci.h`
- `include/nm/timer.h`
- `include/nm/keyboard.h`
- `include/nm/rtl8139.h`
- `kernel/drivers/irq.c`
- `kernel/drivers/pit.c`
- `kernel/drivers/keyboard.c`
- `kernel/drivers/pci.c`
- `kernel/drivers/rtl8139.c`
- `tests/unit/test_irq_pci.c`

## 关键函数签名

- `int irq_register(int irq, nm_irq_top_half_t top_half, nm_irq_bottom_half_t bottom_half, void *ctx,`
  `const char *name);`
- `void irq_run_bottom_halves(void);`
- `void pit_init(uint32_t hz);`
- `void keyboard_init(void);`
- `void pci_init(void);`
- `const struct nm_device *pci_find_device(uint16_t vendor, uint16_t device);`
- `int rtl8139_init(void);`

## 验证命令

```bash
make clean all
make test
make smoke
```
